<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD mapper 3.0//EN"
   "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="jeyi.shion.board.mapper.BoardMapper">
	<resultMap type="hashMap" id="resultMap1">
		<result column="P_DESCRIPTION" property="P_DESCRIPTION"
			jdbcType="CLOB" javaType="java.lang.String" />
	</resultMap>
	
	<resultMap type="hashMap" id="boarMap">
		<result column="RNUM" property="rnum"  jdbcType="VARCHAR" javaType="java.lang.String"/>
		<result column="BOARD_ID" property="boardId" jdbcType="VARCHAR" javaType="java.lang.String"/>
		<result column="BOARD_CREATE_DATE" property="boardCreateDate" jdbcType="VARCHAR" javaType="java.lang.String"/>
		<result column="BOARD_TITLE" property="boardTitle" jdbcType="VARCHAR" javaType="java.lang.String"/>
	</resultMap>

		
	<select id="boardList"  parameterType = "hashMap" resultMap="boarMap">
		<![CDATA[
			SELECT A.RNUM as rnum,
				   A.BOARD_ID,
				   A.BOARD_TITLE,
				   A.BOARD_CREATE_DATE
			FROM (
				SELECT 
					@ROWNUM:=@ROWNUM+1  RNUM, 
					XA.BOARD_ID,
					XA.BOARD_TITLE,
					DATE_FORMAT(XA.BOARD_CREATE_DATE,'%Y-%m-%d') AS BOARD_CREATE_DATE
				FROM
					BOARD XA,
					(SELECT @ROWNUM := 0) R
					WHERE 1=1 
					AND BOARD_DVSN = 1
					ORDER BY BOARD_CREATE_DATE DESC 
							, BOARD_ID DESC
			 ) A
			 WHERE 
			 RNUM BETWEEN #{currentPage}*10-9 AND #{currentPage}*10
			 
		]]>
	</select>

	
	<resultMap type="hashMap" id="searchMap">
	<result column="BOARD_ID" property="boardId" jdbcType="VARCHAR" javaType="java.lang.String"/>
	<result column="BOARD_CREATE_DATE" property="boardCreateDate" jdbcType="VARCHAR" javaType="java.lang.String"/>
	<result column="BOARD_TITLE" property="boardTitle" jdbcType="VARCHAR" javaType="java.lang.String"/>
	</resultMap>

	<select id="searchBoard" parameterType="hashMap" resultMap="searchMap">
		SELECT BOARD_TITLE
			  ,BOARD_ID 
			  ,DATE_FORMAT(NOW(),'%Y-%m-%d') AS BOARD_CREATE_DATE
		  FROM 
			   BOARD 
		 WHERE 
		 	BOARD_TITLE LIKE CONCAT('%', #{boardTitle}, '%')
		 	AND BOARD_DVSN = 1
	</select>


	<select id="boardDetail" parameterType="hashMap" resultType="jeyi.shion.board.vo.BoardVO">
		SELECT * FROM BOARD
		WHERE
		BOARD_ID = #{boardId}
	</select>



	<insert id="boardWrite" parameterType="hashMap">
		INSERT INTO BOARD(
			FILE,
			BOARD_TITLE,
			BOARD_CONTENT,
			BOARD_CREATE_DATE
		)
		VALUES
		(
			#{file},
			#{boardTitle},
			#{boardContent},
			NOW()
		)
	</insert>

	<update id="boardmodify" parameterType="hashMap">
	
		UPDATE BOARD
		SET
			FILE = #{file},
			BOARD_TITLE = #{boardTitle},
			BOARD_CONTENT = #{boardContent},
			BOARD_UPDATE_DATE = NOW()
		WHERE
			BOARD_ID = #{boardId}
	</update>
	
	
	<select id="totalBoard" resultType="int">
		SELECT COUNT(*) CNT FROM BOARD
		WHERE
		BOARD_DVSN = 1
	</select>

	<select id="boardmodifyDetail" parameterType="hashMap" resultType="jeyi.shion.board.vo.BoardVO">
		SELECT * FROM BOARD
		WHERE
		BOARD_ID = #{boardId}
	</select>


	<delete id="boardDelete" parameterType="hashMap">
	
		DELETE FROM BOARD
		WHERE
		BOARD_ID = #{boardId}
		
	</delete>
	
	<insert id="sudaContent" parameterType="hashMap">
		
		insert into BOARD(
			BOARD_TITLE,
			BOARD_CONTENT,  
			BOARD_CREATE_DATE,  
			BOARD_DVSN
		)values(
		 	"수다",
			#{boardContent},
			NOW(),
			2
		)
	</insert>
	
	<select id="sudaList" resultType="jeyi.shion.board.vo.BoardVO">
		SELECT * FROM BOARD
		WHERE
		BOARD_DVSN = 2
		ORDER BY BOARD_ID DESC
	</select>

	
	<select id="MaxSuda" resultType="jeyi.shion.board.vo.BoardVO"> 
		SELECT BOARD_CONTENT,
			   BOARD_ID,
			   BOARD_CREATE_DATE	 
		FROM BOARD
		WHERE
		BOARD_DVSN = 2
		AND
		(SELECT @ROWNUM:= 1)
		ORDER BY BOARD_ID DESC
	</select>


	<delete id="deleteBoard" parameterType="hashMap">
		
		DELETE FROM BOARD
		WHERE 
		BOARD_ID = #{boardId}
	
	</delete>

</mapper>   
   
   